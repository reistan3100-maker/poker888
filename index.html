<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ§§ æ–°å¹´æ‰‘å…‹è®°è´¦(ç›´è¿ç‰ˆ)</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; padding: 20px; text-align: center; }
        .box { background: #2c3e50; padding: 20px; border-radius: 15px; margin-bottom: 20px; }
        .player-row { display: flex; justify-content: space-between; padding: 10px; border-bottom: 1px solid #444; }
        button { background: #27ae60; color: white; border: none; padding: 10px; border-radius: 5px; }
        #my-id { color: #f1c40f; font-weight: bold; }
    </style>
</head>
<body>
    <h2>ğŸ§§ æ‰‘å…‹è®°è´¦ (å…æœåŠ¡å™¨ç‰ˆ)</h2>

    <div class="box">
        <p>ä½ çš„ID: <span id="my-id">æ­£åœ¨è·å–...</span></p>
        <input type="text" id="join-id" placeholder="è¾“å…¥æˆ¿ä¸»çš„ID">
        <button onclick="connectToHost()">åŠ å…¥æˆ¿é—´</button>
    </div>

    <div id="game-area" class="box">
        <div id="player-list"></div>
    </div>

    <script>
        let peer = new Peer(); // åˆ›å»ºç›´è¿å¯¹è±¡
        let connections = [];
        let players = {}; // å­˜å‚¨åˆ†æ•°

        // 1. è·å–è‡ªå·±çš„ ID
        peer.on('open', (id) => {
            document.getElementById('my-id').innerText = id;
            players[id] = { name: "æˆ‘", chips: 1000 };
            render();
        });

        // 2. æˆ¿ä¸»ï¼šç›‘å¬åˆ«äººåŠ å…¥
        peer.on('connection', (conn) => {
            connections.push(conn);
            conn.on('data', (data) => {
                if(data.type === 'join') {
                    players[data.id] = { name: data.name, chips: 1000 };
                    broadcast({ type: 'update', players: players });
                }
                if(data.type === 'transfer') {
                    players[data.from].chips -= data.amount;
                    players[data.to].chips += data.amount;
                    broadcast({ type: 'update', players: players });
                }
            });
        });

        // 3. æˆå‘˜ï¼šè¿æ¥æˆ¿ä¸»
        function connectToHost() {
            const hostId = document.getElementById('join-id').value;
            let conn = peer.connect(hostId);
            conn.on('open', () => {
                conn.send({ type: 'join', id: peer.id, name: "ç©å®¶" + peer.id.substring(0,3) });
            });
            conn.on('data', (data) => {
                if(data.type === 'update') {
                    players = data.players;
                    render();
                }
            });
        }

        // 4. å¹¿æ’­ç»™æ‰€æœ‰äºº
        function broadcast(data) {
            connections.forEach(c => c.send(data));
            render();
        }

        function sendMoney(toId) {
            // è¿™é‡Œä¸ºäº†æ¼”ç¤ºç®€å•ï¼Œé»˜è®¤è½¬è´¦100
            const amount = 100;
            // å¦‚æœæˆ‘æ˜¯æˆ¿ä¸»ç›´æ¥å¤„ç†ï¼Œå¦‚æœæ˜¯æˆå‘˜å‘ç»™æˆ¿ä¸»å¤„ç†
            // (æ­¤ç®€æ˜“ç‰ˆå»ºè®®ç”±ä¸€ä¸ªäººå½“æˆ¿ä¸»æ“ä½œï¼Œæœ€ç¨³å¦¥)
            players[peer.id].chips -= amount;
            players[toId].chips += amount;
            broadcast({ type: 'update', players: players });
        }

        function render() {
            const list = document.getElementById('player-list');
            list.innerHTML = '';
            for(let id in players) {
                const p = players[id];
                list.innerHTML += `
                    <div class="player-row">
                        <span>${p.name}: ${p.chips}</span>
                        ${id !== peer.id ? `<button onclick="sendMoney('${id}')">ç»™ä»–100</button>` : ''}
                    </div>`;
            }
        }
    </script>
</body>
</html>